import { useState, useEffect } from 'react'
import SideNavBar from '../../Components/SideNavBar'
import Modal from '../../Components/Modal'
import { useRef } from 'react'

function Projects() {
  const [projects, setProjects] = useState([])
  const [isDataLoaded, setIsDataLoaded] = useState(false)
  const [isMountedState, setIsMountedState] = useState(false)
  const isMounted = useRef(false);



  const GetData = async () => {
    const res = await fetch('http://localhost:3000/api/projectDB', {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
      },
    })
    const data = await res.json()
    setProjects(data)
    setIsDataLoaded(true);
  }

  useEffect(() => {
    if (isMounted.current) {
      isMounted.current =  !isMounted.current;
      console.log("IS")
      setIsMountedState( isMounted.current)
    } else {
      isMounted.current =  !isMounted.current;
      console.log("NOT")
    }
  },[])


  useEffect(() => {
    console.log("MOUNTED")
    console.log(isMounted);
    return async () => {
      console.log("UNM")
      if (!isDataLoaded) {
        GetData()
       
        isMounted.current = true;
      }
    }
  }, [isMounted])

  console.log("dsd")
  const animation = (
    <div style={{ textAlign: 'center', marginTop: 'auto' }}>
      <img
        style={{ maxWidth: '500px', transition: 'background-color 300ms' }}
        alt="Loading animation created by https://dribbble.com/liliantedone"
        src="https://cdn.dribbble.com/users/744913/screenshots/4094897/media/771a495231b798c0ccf7a59a19f31946.gif"
      ></img>
    </div>
  )



 

  const loading = () => {
    return 
  }

  const body = (
    <>
      {/* <SideNavBar /> */}
      <h1 style={{ textAlign: 'center' }}>All Projects</h1>
      <div className="gridLayout">
        {projects.map((projects) => {
          return (
            <div
              key={projects.id}
              style={{ padding: '10px' }}
            >
              <Modal props={{
                id: projects.id,
                title: projects.title,
                date: projects.date,
                details: projects.details,
                skills: projects.skills,
                img: projects.img,
                gallery: projects.gallery,
                link: projects.link,
                category: projects.category,
              }} />

            </div>
          )
        })}
      </div>
    </>
  )


  var view = isDataLoaded ? body : animation;
 


    const none = <h1 style={{ textAlign: 'center' }}>No Projects Found</h1>
    


  return <>{view}</>
}

export default Projects
